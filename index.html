<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avery L4760 Ordneretiketten</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 15px;
}

.topbar {
  max-width: 210mm;
  margin: 0 auto 10px;
  display: flex;
  justify-content: space-between;
}

button {
  padding: 10px 14px;
  font-size: 15px;
  border: none;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
}
.reset { background: #c9302c; }
.pdf { background: #0275d8; }

.sheet {
  width: 210mm;
  height: 297mm;
  background: #fff;
  display: grid;
  grid-template-columns: 38mm 38mm;
  grid-template-rows: repeat(4, 192mm);
  justify-content: center;
}

.label {
  border: 1px dashed #aaa;
  box-sizing: border-box;
  padding: 6mm 4mm;
}

.text {
  font-size: 14px;
  white-space: pre-line;
  height: 100%;
}
</style>
</head>

<body>

<div class="topbar">
  <button class="reset" onclick="resetAll()">Reset</button>
  <button class="pdf" onclick="makePDF()">PDF erstellen</button>
</div>

<div class="sheet" id="sheet"></div>

<script>
/*
Avery L4760 Layout:
[0][1]
[2][3]
[4][5]
[6][ ]
*/
const POS = [
  {c:0,r:0},{c:1,r:0},
  {c:0,r:1},{c:1,r:1},
  {c:0,r:2},{c:1,r:2},
  {c:0,r:3}
];

const LABEL_W = 38;
const LABEL_H = 192;

/* Feintuning falls Drucker minimal abweicht */
const SHIFT_X_MM = 0;
const SHIFT_Y_MM = 0;

/* UI bauen */
POS.forEach((_, i) => {
  sheet.insertAdjacentHTML("beforeend", `
    <div class="label">
      <div class="text" id="t${i}" contenteditable>
ORDNER ${i + 1}
      </div>
    </div>
  `);
});

function resetAll() {
  POS.forEach((_, i) => {
    document.getElementById("t"+i).innerText = "";
  });
}

/* PDF */
async function makePDF() {
  const pdf = await PDFLib.PDFDocument.create();
  const page = pdf.addPage([595, 842]); // A4
  const font = await pdf.embedFont(PDFLib.StandardFonts.Helvetica);
  const mm = v => v * 2.83465;

  const totalW = LABEL_W * 2;
  const startX = (210 - totalW) / 2 + SHIFT_X_MM;

  POS.forEach((p, i) => {
    const text = document.getElementById("t"+i).innerText.trim();
    if (!text) return;

    const x0 = mm(startX + p.c * LABEL_W);
    const y0 = 842 - mm((p.r + 1) * LABEL_H + SHIFT_Y_MM);

    /* ðŸ”¥ WICHTIG: Textblock EINMAL drehen */
    const lines = text.split("\n");
    const block = lines.join("\n");

    page.drawText(block, {
      x: x0 + mm(LABEL_W - 6),
      y: y0 + mm(10),
      size: 14,
      font,
      rotate: PDFLib.degrees(90),
      lineHeight: 16
    });
  });

  const bytes = await pdf.save();
  const blob = new Blob([bytes], { type: "application/pdf" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "avery_L4760_ordneretiketten_final.pdf";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>

</body>
</html>
