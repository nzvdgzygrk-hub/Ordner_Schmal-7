<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avery Ordneretiketten 38×192 – 7 Stück</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:16px;
}

.topbar{
  max-width:1200px;
  margin:0 auto 12px;
  display:flex;
  gap:10px;
}

button{
  padding:10px 14px;
  font-size:15px;
  border:0;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
}
.reset{background:#c9302c}
.pdf{background:#0275d8}

.wrapper{
  max-width:1200px;
  margin:0 auto;
  background:#fff;
  padding:14px;
  border-radius:10px;
}

.info{
  font-size:13px;
  color:#444;
  margin-bottom:12px;
}

/* UI-GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.card{
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
}

.card h3{
  margin:0 0 6px;
  font-size:14px;
}

/* Eingabe + Vorschau nebeneinander */
.editRow{
  display:flex;
  gap:12px;
  align-items:flex-start;
}

textarea{
  flex:1;
  min-height:140px;
  resize:vertical;
  font-size:14px;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  box-sizing:border-box;
}

/* ECHTE DRUCKVORSCHAU */
.preview{
  width:38mm;
  height:192mm;
  border:2px solid #000;
  background:#fff;
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:center;
}

.preview canvas{
  width:100%;
  height:100%;
  display:block;
}
</style>
</head>

<body>

<div class="topbar">
  <button class="reset" onclick="resetAll()">Reset</button>
  <button class="pdf" onclick="makePDF()">PDF erstellen</button>
</div>

<div class="wrapper">
  <div class="info">
    Links schreibst du. Rechts siehst du die <b>echte Druckfläche (38×192 mm)</b>.<br>
    Leserichtung: <b>unten → oben</b>.  
    <br>Was rechts passt, passt auch im PDF.
  </div>

  <div class="grid" id="grid"></div>
</div>

<script>
/* KONSTANTEN */
const LABELS = 7;
const LABEL_W_MM = 192;
const LABEL_H_MM = 38;
const PX_PER_MM = 6;
const FONT_PX = 28;

/* UI ERZEUGEN */
const grid = document.getElementById("grid");

for(let i=1;i<=LABELS;i++){
  grid.insertAdjacentHTML("beforeend",`
    <div class="card">
      <h3>ORDNER ${i}</h3>
      <div class="editRow">
        <textarea id="t${i}">ORDNER ${i}</textarea>
        <div class="preview">
          <canvas id="c${i}"></canvas>
        </div>
      </div>
    </div>
  `);
}

/* RESET */
function resetAll(){
  for(let i=1;i<=LABELS;i++){
    document.getElementById("t"+i).value="";
    drawPreview(i);
  }
}

/* PREVIEW ZEICHNEN (GENAU WIE DRUCK) */
function drawPreview(i){
  const text = document.getElementById("t"+i).value;
  const canvas = document.getElementById("c"+i);
  const ctx = canvas.getContext("2d");

  const W = Math.round(LABEL_W_MM * PX_PER_MM);
  const H = Math.round(LABEL_H_MM * PX_PER_MM);

  canvas.width = W;
  canvas.height = H;

  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,W,H);

  ctx.save();
  ctx.translate(W/2,H/2);
  ctx.rotate(-Math.PI/2); // unten -> oben

  ctx.font = `bold ${FONT_PX}px Arial`;
  ctx.fillStyle="#000";
  ctx.textAlign="center";
  ctx.textBaseline="middle";

  const lines = text.split("\n");
  const lineHeight = FONT_PX * 1.25;
  let y = -(lines.length-1)*lineHeight/2;

  for(const line of lines){
    ctx.fillText(line,0,y);
    y+=lineHeight;
  }

  ctx.restore();
}

/* LIVE UPDATE */
for(let i=1;i<=LABELS;i++){
  document.getElementById("t"+i)
    .addEventListener("input",()=>drawPreview(i));
  drawPreview(i);
}

/* mm -> pt */
const mm = v => v * 2.83465;

/* PDF ERSTELLEN */
async function makePDF(){
  const pdf = await PDFLib.PDFDocument.create();
  const page = pdf.addPage([595,842]); // A4 hoch

  const left = (210 - LABEL_W_MM) / 2;      // 9 mm
  const top  = (297 - LABELS*LABEL_H_MM)/2;// 15.5 mm

  for(let i=1;i<=LABELS;i++){
    const canvas = document.getElementById("c"+i);
    const imgBytes = await fetch(canvas.toDataURL("image/png"))
                           .then(r=>r.arrayBuffer());
    const img = await pdf.embedPng(imgBytes);

    const x = mm(left);
    const y = 842 - mm(top + i*LABEL_H_MM);

    page.drawImage(img,{
      x,y,
      width:mm(LABEL_W_MM),
      height:mm(LABEL_H_MM)
    });
  }

  const out = await pdf.save();
  const blob = new Blob([out],{type:"application/pdf"});
  const url = URL.createObjectURL(blob);

  const a=document.createElement("a");
  a.href=url;
  a.download="Ordneretiketten_38x192_7Stk.pdf";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>

</body>
</html>
