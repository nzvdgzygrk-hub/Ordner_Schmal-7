<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Ordneretiketten 38×192</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:16px;
}

button{
  padding:10px 14px;
  border-radius:6px;
  border:0;
  cursor:pointer;
  color:#fff;
}
.pdf{background:#0275d8}
.reset{background:#c9302c}

.wrapper{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:16px;
  border-radius:10px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:18px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.card{
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
}

.header{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

/* DRUCK-VORSCHAU (echte Größe) */
.preview{
  width:192mm;
  height:38mm;
  border:1px dashed #999;
  margin-bottom:6px;
  position:relative;
  overflow:hidden;
}

.preview-inner{
  position:absolute;
  inset:0;
  transform:rotate(-90deg);
  transform-origin:center;
}

/* Text */
.preview-title{
  position:absolute;
  top:6mm;
  left:8mm;
  right:8mm;
  font-size:20px;
  font-weight:bold;
}

.preview-lines{
  position:absolute;
  top:18mm;
  left:8mm;
  right:18mm;
  bottom:12mm;
  background:
    repeating-linear-gradient(
      to bottom,
      transparent,
      transparent 12px,
      #000 13px
    );
}

.preview-number{
  position:absolute;
  bottom:6mm;
  right:6mm;
  font-size:16px;
  font-weight:bold;
}

/* Eingabe */
input, textarea{
  width:100%;
  box-sizing:border-box;
  margin-top:4px;
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

textarea{
  min-height:100px;
  resize:vertical;
}
</style>
</head>

<body>

<button class="reset" onclick="resetAll()">Reset</button>
<button class="pdf" onclick="makePDF()">PDF erstellen</button>

<div class="wrapper">
  <div class="grid" id="grid"></div>
</div>

<script>
const LABELS = 7;
const grid = document.getElementById("grid");

for(let i=1;i<=LABELS;i++){
  grid.insertAdjacentHTML("beforeend",`
  <div class="card">
    <div class="header">
      <strong>ORDNER ${i}</strong>
      <label>Drucken <input type="checkbox" id="p${i}" checked></label>
    </div>

    <div class="preview">
      <div class="preview-inner">
        <div class="preview-title" id="pt${i}"></div>
        <div class="preview-lines"></div>
        <div class="preview-number" id="pn${i}"></div>
      </div>
    </div>

    <input id="t${i}" placeholder="Überschrift (z. B. Haus 2021)" oninput="update(${i})">
    <textarea id="b${i}" placeholder="Freitext – Linien erscheinen NUR im Druck"></textarea>
    <input id="n${i}" placeholder="Nummer (z. B. 01)" oninput="update(${i})">
  </div>
  `);

  document.getElementById(`n${i}`).value = String(i).padStart(2,"0");
  update(i);
}

function update(i){
  document.getElementById(`pt${i}`).innerText =
    document.getElementById(`t${i}`).value;
  document.getElementById(`pn${i}`).innerText =
    document.getElementById(`n${i}`).value;
}

function resetAll(){
  for(let i=1;i<=LABELS;i++){
    document.getElementById(`t${i}`).value="";
    document.getElementById(`b${i}`).value="";
    document.getElementById(`n${i}`).value=String(i).padStart(2,"0");
    update(i);
  }
}

/* PDF */
const mm = v => v*2.83465;

async function makePDF(){
  const pdf = await PDFLib.PDFDocument.create();
  const page = pdf.addPage([595,842]);

  const left = (210-192)/2;
  const top  = (297-7*38)/2;

  let slot=0;

  for(let i=1;i<=LABELS;i++){
    if(!document.getElementById(`p${i}`).checked) continue;

    const title = document.getElementById(`t${i}`).value;
    const text  = document.getElementById(`b${i}`).value.split("\n");
    const num   = document.getElementById(`n${i}`).value;

    const c=document.createElement("canvas");
    c.width=192*6; c.height=38*6;
    const x=c.getContext("2d");
    x.fillStyle="#fff"; x.fillRect(0,0,c.width,c.height);

    x.save();
    x.translate(c.width/2,c.height/2);
    x.rotate(-Math.PI/2);

    x.fillStyle="#000";
    x.font="bold 28px Arial";
    x.fillText(title,40,60);

    let y=110;
    x.font="20px Arial";
    for(let k=0;k<14;k++){
      x.beginPath();
      x.moveTo(40,y);
      x.lineTo(c.height-80,y);
      x.stroke();
      if(text[k]) x.fillText(text[k],45,y-4);
      y+=28;
    }

    x.font="bold 22px Arial";
    x.fillText(num,c.height-60,c.width/2+120);

    x.restore();

    const img=await pdf.embedPng(c.toDataURL());
    page.drawImage(img,{
      x:mm(left),
      y:842-mm(top+(slot+1)*38),
      width:mm(192),
      height:mm(38)
    });

    slot++;
  }

  const blob=new Blob([await pdf.save()],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Ordneretiketten.pdf";
  a.click();
}
</script>

</body>
</html>
