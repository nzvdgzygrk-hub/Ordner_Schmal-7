<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Ordneretiketten 38×192</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:16px}
.topbar{max-width:1200px;margin:auto;margin-bottom:12px;display:flex;gap:10px}
button{padding:10px 16px;border:0;border-radius:6px;color:#fff;font-size:15px;cursor:pointer}
.reset{background:#c9302c}
.pdf{background:#0275d8}

.wrapper{max-width:1200px;margin:auto;background:#fff;padding:14px;border-radius:10px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{border:1px solid #ddd;border-radius:10px;padding:10px}
.cardHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}

/* VORSCHAU – echte Druckgröße */
.preview{
  width:192mm;
  height:38mm;
  border:1px dashed #999;
  margin-bottom:6px;
  position:relative;
  overflow:hidden;
}

/* Inhalt (gedreht wie am Ordner) */
.previewInner{
  position:absolute;
  inset:0;
  transform:rotate(-90deg);
  transform-origin:center;
  display:flex;
  width:38mm;
  height:192mm;
}

/* Spalten */
.colLeft{width:28mm;padding:4mm 2mm;font-weight:bold;font-size:18px}
.colMain{flex:1;position:relative;padding:6mm 4mm}
.colNum{width:16mm;display:flex;align-items:flex-end;justify-content:center;font-weight:bold}

/* Linien (NUR VORSCHAU-HILFE) */
.lines{
  position:absolute;
  inset:0;
  background:
    repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent 16px,
      rgba(0,0,0,.25) 17px
    );
}

/* Eingaben */
input,textarea{
  width:100%;
  box-sizing:border-box;
  font-size:14px;
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
}
textarea{min-height:110px;resize:vertical}
</style>
</head>

<body>

<div class="topbar">
  <button class="reset" onclick="resetAll()">Reset</button>
  <button class="pdf" onclick="makePDF()">PDF erstellen</button>
</div>

<div class="wrapper">
  <div class="grid" id="grid"></div>
</div>

<script>
const LABELS=7;
const grid=document.getElementById("grid");

for(let i=1;i<=LABELS;i++){
  grid.insertAdjacentHTML("beforeend",`
  <div class="card">
    <div class="cardHeader">
      <strong>ORDNER ${i}</strong>
      <label>Drucken <input type="checkbox" id="p${i}" checked></label>
    </div>

    <div class="preview">
      <div class="previewInner">
        <div class="colLeft" id="vh${i}"></div>
        <div class="colMain">
          <div class="lines"></div>
          <div id="vm${i}" style="position:relative;white-space:pre;font-size:14px"></div>
        </div>
        <div class="colNum" id="vn${i}"></div>
      </div>
    </div>

    <input id="h${i}" placeholder="Überschrift (z. B. Haus 2021)" oninput="upd(${i})">
    <textarea id="m${i}" placeholder="Freitext – Linien erscheinen erst im Druck" oninput="upd(${i})"></textarea>
    <input id="n${i}" placeholder="Nummer (z. B. 01)" oninput="upd(${i})">
  </div>`);
}

function upd(i){
  vh(i).textContent=h(i).value;
  vm(i).textContent=m(i).value;
  vn(i).textContent=n(i).value;
}
function h(i){return document.getElementById("h"+i)}
function m(i){return document.getElementById("m"+i)}
function n(i){return document.getElementById("n"+i)}
function vh(i){return document.getElementById("vh"+i)}
function vm(i){return document.getElementById("vm"+i)}
function vn(i){return document.getElementById("vn"+i)}

function resetAll(){
  for(let i=1;i<=LABELS;i++){
    h(i).value="";
    m(i).value="";
    n(i).value=String(i).padStart(2,"0");
    upd(i);
  }
}
resetAll();

/* mm → pt */
const mm=v=>v*2.83465;

async function makePDF(){
  const pdf=await PDFLib.PDFDocument.create();
  const page=pdf.addPage([595,842]);

  const startY=(297-LABELS*38)/2;
  let slot=0;

  for(let i=1;i<=LABELS;i++){
    if(!document.getElementById("p"+i).checked)continue;

    const c=document.createElement("canvas");
    c.width=38*6;
    c.height=192*6;
    const x=c.getContext("2d");

    x.fillStyle="#fff";
    x.fillRect(0,0,c.width,c.height);

    /* Linien bis über Zahl */
    x.strokeStyle="#000";
    for(let y=20;y<c.height-60;y+=28){
      x.beginPath();
      x.moveTo(70,y);
      x.lineTo(c.width-20,y);
      x.stroke();
    }

    /* Text */
    x.save();
    x.translate(c.width/2,c.height/2);
    x.rotate(-Math.PI/2);
    x.fillStyle="#000";

    x.font="bold 28px Arial";
    x.fillText(h(i).value||"", -90, -60);

    x.font="24px Arial";
    let ty=-20;
    m(i).value.split("\n").forEach(l=>{
      x.fillText(l,-90,ty);
      ty+=28;
    });

    x.font="bold 26px Arial";
    x.fillText(n(i).value||"",80,80);
    x.restore();

    const img=await pdf.embedPng(c.toDataURL());
    page.drawImage(img,{
      x:mm((210-192)/2),
      y:842-mm(startY+(slot+1)*38),
      width:mm(192),
      height:mm(38)
    });
    slot++;
  }

  const blob=new Blob([await pdf.save()],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Ordneretiketten_38x192.pdf";
  a.click();
}
</script>
</body>
</html>
