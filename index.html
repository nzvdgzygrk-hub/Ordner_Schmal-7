<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Ordneretiketten 38×192</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:16px;
}

button{
  padding:10px 16px;
  border:0;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
}
.reset{background:#c9302c}
.pdf{background:#0275d8}

.wrapper{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:16px;
  border-radius:10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}

.card{
  border:1px solid #ccc;
  border-radius:10px;
  padding:10px;
}

.header{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

/* echte Größe */
.preview{
  width:192mm;
  height:38mm;
  border:1px dashed #999;
  margin-bottom:8px;
  position:relative;
  overflow:hidden;
}

.previewContent{
  position:absolute;
  inset:0;
  padding:6mm 6mm 10mm 6mm;
  transform:rotate(-90deg);
  transform-origin:center;
  white-space:pre;
  font-size:18px;
}

input, textarea{
  width:100%;
  box-sizing:border-box;
  margin-top:6px;
  padding:6px;
  border-radius:6px;
  border:1px solid #bbb;
  font-size:14px;
}

textarea{
  min-height:120px;
  resize:vertical;
}
</style>
</head>

<body>

<button class="reset" onclick="resetAll()">Reset</button>
<button class="pdf" onclick="makePDF()">PDF erstellen</button>

<div class="wrapper">
  <div class="grid" id="grid"></div>
</div>

<script>
const LABELS = 7;
const grid = document.getElementById("grid");

for(let i=1;i<=LABELS;i++){
  grid.insertAdjacentHTML("beforeend",`
    <div class="card">
      <div class="header">
        <strong>ORDNER ${i}</strong>
        <label>Drucken <input type="checkbox" id="p${i}" checked></label>
      </div>

      <div class="preview">
        <div id="v${i}" class="previewContent"></div>
      </div>

      <input id="h${i}" placeholder="Überschrift (z. B. Haus 2021)">
      <textarea id="t${i}" placeholder="Freitext – Linien erscheinen erst im Druck"></textarea>
      <input id="n${i}" placeholder="Nummer unten (z. B. 01)">
    </div>
  `);

  document.getElementById(`n${i}`).value = String(i).padStart(2,"0");
  updatePreview(i);
  ["h","t","n"].forEach(x=>{
    document.getElementById(x+i).oninput=()=>updatePreview(i);
  });
}

function updatePreview(i){
  const h=document.getElementById("h"+i).value;
  const t=document.getElementById("t"+i).value;
  const n=document.getElementById("n"+i).value;

  document.getElementById("v"+i).innerText =
`${h}

${t}


${n}`;
}

function resetAll(){
  for(let i=1;i<=LABELS;i++){
    document.getElementById("h"+i).value="";
    document.getElementById("t"+i).value="";
    document.getElementById("n"+i).value=String(i).padStart(2,"0");
    updatePreview(i);
  }
}

// mm → pt
const mm=v=>v*2.83465;

async function makePDF(){
  const pdf=await PDFLib.PDFDocument.create();
  const page=pdf.addPage([595,842]);

  const startY=(297-7*38)/2;

  let slot=0;

  for(let i=1;i<=LABELS;i++){
    if(!document.getElementById("p"+i).checked) continue;

    const h=document.getElementById("h"+i).value;
    const t=document.getElementById("t"+i).value;
    const n=document.getElementById("n"+i).value;

    const canvas=document.createElement("canvas");
    canvas.width=192*6;
    canvas.height=38*6;
    const ctx=canvas.getContext("2d");

    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.save();
    ctx.translate(canvas.width/2,canvas.height/2);
    ctx.rotate(-Math.PI/2);

    ctx.strokeStyle="#000";
    ctx.lineWidth=1;

    // Linien (großer Abstand)
    let y=-canvas.height/2+40;
    const lineGap=48;
    while(y<canvas.height/2-80){
      ctx.beginPath();
      ctx.moveTo(-canvas.width/2+30,y);
      ctx.lineTo(canvas.width/2-80,y);
      ctx.stroke();
      y+=lineGap;
    }

    // Text
    ctx.fillStyle="#000";
    ctx.textAlign="left";

    ctx.font="bold 28px Arial";
    ctx.fillText(h,-canvas.width/2+30,-canvas.height/2+30);

    ctx.font="22px Arial";
    let ty=-canvas.height/2+80;
    t.split("\n").forEach(l=>{
      ctx.fillText(l,-canvas.width/2+30,ty);
      ty+=lineGap;
    });

    ctx.font="bold 26px Arial";
    ctx.fillText(n,canvas.width/2-60,canvas.height/2-40);

    ctx.restore();

    const img=await pdf.embedPng(canvas.toDataURL());
    page.drawImage(img,{
      x:mm((210-192)/2),
      y:842-mm(startY+(slot+1)*38),
      width:mm(192),
      height:mm(38)
    });

    slot++;
  }

  const blob=new Blob([await pdf.save()],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Ordneretiketten.pdf";
  a.click();
}
</script>

</body>
</html>
